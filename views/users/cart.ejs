
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="Untree.co">
  <link rel="shortcut icon" href="favicon.png">

  <meta name="description" content="" />
  <meta name="keywords" content="bootstrap, bootstrap4" />

		<!-- Bootstrap CSS -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
		<link href="css/tiny-slider.css" rel="stylesheet">
		<link href="css/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
		<title>Apollo Furniture </title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
	</head>

	<body>

		<!-- Start Header/Navigation -->
		<nav class="custom-navbar navbar navbar navbar-expand-md navbar-dark bg-dark" arial-label="Furni navigation bar">

			<div class="container">
				<a class="navbar-brand" href="/">Apollo Furniture<span>.</span></a>

				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsFurni" aria-controls="navbarsFurni" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>

				<div class="collapse navbar-collapse" id="navbarsFurni">
					<ul class="custom-navbar-nav navbar-nav ms-auto mb-2 mb-md-0">
						<li>
							<a class="nav-link" href="/">Home</a>
						</li>
						<li><a class="nav-link" href="/shop">Shop</a></li>
						<li ><a class="nav-link" href="/about">About us</a></li>
						<li><a class="nav-link" href="/services">Services</a></li>
						<li><a class="nav-link" href="/blog">Blog</a></li>
						<li><a class="nav-link" href="/contact">Contact us</a></li>
					</ul>

					<ul class="custom-navbar-cta navbar-nav mb-2 mb-md-0 ms-5">
						<li><a class="nav-link" href="/userProf"><img src="images/user.svg"></a></li>
						<li><a class="nav-link" href="/cart"><img src="images/cart.svg"></a></li>
            <li><a class="nav-link" href="/wishlist"><i class="fa-regular fa-heart" id="wishicon"></i></a></li>
					</ul>
				</div>
			</div>
				
		</nav>
		<!-- End Header/Navigation -->
    
    <!-- Start Hero Section -->
    <div class="hero">
        <div class="container">
            <div class="row justify-content-between">
                <div class="col-lg-5">
                    <div class="intro-excerpt">
                        <h1>Cart</h1>
                    </div>
                </div>
                <div class="col-lg-7">
                    
                </div>
            </div>
        </div>
    </div>
<!-- End Hero Section -->



<div class="untree_co-section before-footer-section">
    <div class="container" id="reload">
      <div class="row mb-5">
        <form class="col-md-12" method="post">
          <div class="site-blocks-table">

            
            <%if (!cartDetails || (cartDetails.items && cartDetails.items.length === 0)) { %>
              <div class="container">
                <div class="row justify-content-center"> <!-- Center the content horizontally -->
                    <div class="col-md-4">
                        <div>
                            <h1 class="text-muted">Your cart is empty</h1>
                            <p class="text-center">Add items to it now</p>
                        </div>
                        <div class="text-center"> <!-- Center the button -->
                            <a href='/shop'><button type="button" class="btn btn-outline-black btn-sm">Continue Shopping</button></a>
                        </div>
                    </div>
                </div>
            </div>

              <% }else if(cartDetails && cartDetails.items && cartDetails.items.length > 0){ %>
                <% cartDetails.items = cartDetails.items.filter(item => item.product_id.isListed === true); %>
                
            <table class="table">
              <thead>
                <tr>
                  <th class="product-thumbnail">Image</th>
                  <th class="product-name">Product</th>
                  <th class="product-price">Price</th>
                  <th class="product-quantity">Quantity</th>
                  <th class="product-total">Total</th>
                  <th class="product-remove">Remove</th>
                </tr>
              </thead>
              <tbody>
                
                <% let totalPrice = 0 %>
                <% let sumtot = 0 %>
                  <% cartDetails.items.forEach((cartItem) => { %>
                    
                <tr>
                  <td class="product-thumbnail">
                    <img src="<%= cartItem.product_id.images[0] %>" alt="Image" class="img-fluid">
                  </td>
                  <td class="product-name">
                    <h2 class="h5 text-black"><%= cartItem.product_id.name %></h2>
                  </td>
                  
                  <% 
                   let itemPrice = cartItem.product_id.price;
                   if(cartItem.product_id.offer && cartItem.product_id.categoryId.offer){

                   itemPrice -= (itemPrice * cartItem.product_id.offer.percentage / 100);

                   } else if(cartItem.product_id.categoryId && cartItem.product_id.categoryId.offer){
                    
                  itemPrice -= (itemPrice * cartItem.product_id.categoryId.offer.percentage / 100);

                 } else if(cartItem.product_id.offer){

                  itemPrice -= (itemPrice * cartItem.product_id.offer.percentage / 100);

                  }

                 

                 %>
                 <td>₹<%= itemPrice %>.00</td>
                  <td>
                    <div class="input-group mb-3 d-flex align-items-center quantity-container" style="max-width: 120px;">
                      <div class="input-group-prepend">
                        <button class="btn btn-outline-black decrease" type="button" onclick="quantityControl('<%= cartDetails._id%>','<%=cartItem.product_id._id %>',-1)">&minus;</button>
                      </div>
                      <input type="text" class="form-control text-center quantity-amount" value="<%= cartItem.quantity %>" placeholder="" aria-label="Example text with button addon" aria-describedby="button-addon1" readonly>
                      <div class="input-group-append">
                        <button class="btn btn-outline-black increase" type="button" onclick="quantityControl('<%= cartDetails._id%>','<%=cartItem.product_id._id %>',1)">&plus;</button>
                      </div>
                    </div>

                  </td>
                  
                  </td> 
                  
                  <td>₹<%= itemPrice*cartItem.quantity %>.00</td>
                  <% totalPrice += itemPrice * cartItem.quantity %>
                  
                  
                  <td><a href="#" class="btn btn-black btn-sm" onclick="deleteCartProduct('<%= cartItem._id %>')">X</a></td>
                </tr>

                  <% }) %>
              </tbody>
            </table>
            
          </div>
        </form>
      </div>


        

      
  

      <div class="row">
        <div class="col-md-6">
          <div class="row mb-5">
            <!-- <div class="col-md-6 mb-3 mb-md-0">
              <button class="btn btn-black btn-sm btn-block">Update Cart</button>
            </div> -->
            
          </div>
          <div class="row">
            
            <!-- <div class="col-md-12 mb-3 mb-md-0">
              <label class="text-black h4" for="coupon">Apply Coupon</label>
               <input type="text" class="form-control py-3" id="coupon" placeholder="Coupon Code"> 
              <div class="card-body" id="reloadDiv">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                
                                
                            </tr>
                        </thead>
                        <tbody>
                          <td>
                            
                            <h4 id="couponcode"> <%= coupon[0].couponCode %></h4>
                          </td>
                          <td>
                            <%= coupon[0].couponDescription %>
                          </td>
                          <td>
                            <button class="btn btn-sm btn-primary" id="applybtn" onclick="applyCoupon(event,'<%= coupon[0].couponCode %>')"<% if(sumtot<coupon[0].minAmount){%> disabled <% } %>>Apply</button>
                          </td>
                        </tbody>
                        </table>
            </div>
            <p id="more" style="text-decoration: underline; cursor: pointer;">More</p>
            </div>
            </div> -->
            <!-- <div class="col-md-4">
              <button class="btn btn-black">Apply Coupon</button>
            </div> -->
          </div>
        </div>
        <div class="col-md-6 pl-5">
          <div class="row justify-content-end">
            <div class="col-md-7">
              <div class="row">
                <div class="col-md-12 text-right border-bottom mb-5">
                  <h3 class="text-black h4 text-uppercase">Cart Totals</h3>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-md-6">
                  <span class="text-black">Subtotal</span>
                </div>
                <div class="col-md-6 text-right">
                  <strong class="text-black">₹<%= totalPrice %>.00</strong>
                </div>
              </div>


              <!-- <div class="row mb-3" id="discountDiv" style="display: none;">
                <div class="col-md-6">
                  <span class="text-black">Discount Applied</span>
                </div>
                <div class="col-md-6 text-right">
                  <strong class="text-black" id="discountAmt"></strong>
                </div>
              </div> -->
              <div class="row mb-5">
                <div class="col-md-6">
                  <span class="text-black">Total</span>
                </div>
                <div class="col-md-6 text-right">
                  <strong class="text-black" id="totamt">₹<%= totalPrice %>.00</strong>
                </div>
              </div>

              <div class="row">
                <div class="col-md-12">
                  <button class="btn btn-black btn-lg py-3 btn-block" onclick="window.location='/checkout'">Proceed To Checkout</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <% } %>

        
    </div>
    
  </div>

  <!-- <div class="modal fade" id="couponModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Available Coupons</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <% if(coupon && coupon.length > 0) { %>

            <ul class="list-group">
              <% coupon.forEach((coupon)=> { %>
                <li class="list-group-item">
                  <div>
                    <h6><%= coupon.couponName %></h6>
                    <p><%= coupon.couponDescription %></p>
                    
                    <a href="#" class="btn btn-warning btn-sm" onclick="applyCoupon(event,'<%= coupon.couponCode %>')">Apply</a>
                  </div>
                </li>
              <% }) %>
            </ul>
          <% } else { %>
            <p>No coupons available.</p>



          <% } %>
          </div>
          
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div> -->

  


  <script>


// async function applyCoupon(event,couponCode){
//     event.preventDefault()
//   try {
    
//     const response = await axios.post(`/applyCoupon?code=${couponCode}`)
//     if(response.data){
//       updateCart(response.data.discountAmount)
//     }
//   } catch (error) {
//     console.log(error.message)
//   }
    

// }


// function updateCart(discountAmount){
//    document.getElementById("discountDiv").style.display = "block";
//             // Update the discount amount
//             document.getElementById("discountAmt").innerText = `-₹${discountAmount}.00`;
//             document.getElementById("applybtn").disabled = true;
//             // Change the button text to "Applied!"
//             document.getElementById("applybtn").innerText = "Applied!";

//             const totalAmount = document.getElementById('totamt')
//             const currentTotal = parseFloat(totalAmount.innerText.replace("₹",""))
//             const reducedTotal = currentTotal - parseFloat(discountAmount)
//             totalAmount.innerText = `₹${reducedTotal}.00`
            
//             $.ajax({
//               url:'/getCoupon',
//               method:'post',
//               data:{discountAmount:discountAmount,
//               reducedTotal:reducedTotal},

//             })
           

// }





      async function deleteCartProduct(productid){

          try {
            event.preventDefault()
            
            const response = await axios.post(`/deleteCartProduct?id=${productid}`);

            if(response.data.success){
              Swal.fire("Product Removed!").then((result)=>{
                if (result.isConfirmed) {
                                  
                $('#reload').load('/cart #reload');
                 } else if (result.dismiss === Swal.DismissReason.cancel) {
                                    
                 }
              })
            }else{
              Swal.fire("Failed!")
            }




          } catch (error) {
            console.error('An error occurred during the request', error);
          }


      }





      //quantitycontrols


      function quantityControl(cartid,productid,count){

        $.ajax({
      url: '/changeQuantity',
      method: 'post',
      data: {
        cartId: cartid,
        productId: productid,
        count: count,
      },
      success: (response) => {
        if (response.success) {
          $('#reload').load('/cart #reload');
        } else {
          Swal.fire({
            title: 'Error',
            icon: 'error',
            text: response.message,
            timer: 2000,
          });
          
        }
      },
      error: (error) => {
        Swal.fire({
          title: 'Error',
          icon: 'error',
          text: response.message,
          timer: 1500,
        });
      },
    });

      }

      


      //coupon modal



  //     document.getElementById('more').addEventListener('click', function() {
  //   var myModal = new bootstrap.Modal(document.getElementById('couponModal'));
  //   myModal.show();
  // });

  </script>

  <%- include('../partials/footer') -%>